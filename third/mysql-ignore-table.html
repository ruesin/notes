<!DOCTYPE HTML>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>Ecstore通过dbschema更改数据表。WARNING:512 @ ALTER IGNORE TABLE-信口开河</title>
    <meta name="keywords" content="Ruesin,信口开河">
    <meta name="description" content="至于你信不信，反正我是信了。">
    <link rel="stylesheet" href="/css/style.css">
</head>
  <body>
    
<header class="header">
    <nav class="navbar">
        <ul>
            
            <li><a class="header-nav-link" href="/">首页</a></li>
            
            <li><a class="header-nav-link" href="/categories">分类</a></li>
            
            <li><a class="header-nav-link" href="/archives">归档</a></li>
            
            <li><a class="header-nav-link" href="/tags">标签</a></li>
            
            <li><a class="header-nav-link" href="https://github.com/ruesin/notes">Github</a></li>
            
            <li><a class="header-nav-link" href="https://ruesin.github.io/php-tree">PHP技能树</a></li>
            
            <li><a class="header-nav-link" href="https://www.xinkoukaihe.com">老博客</a></li>
            
        </ul>
    </nav>
</header>
    <main class="main">
      <!-- 内容页 -->
<section class="section">
    <div class="post-container">
        <div class="post-header">
                <h1>Ecstore通过dbschema更改数据表。WARNING:512 @ ALTER IGNORE TABLE</h1>
                <!-- <div class="post-meta">2015-04-20</div> -->
        </div>
        <article class="post-content">
            <p>最近做了个项目，二开了b2c_members数据表，dbschema定义很规范，执行cmd update，本地测试一切正常，测试服务器上也没问题，后续的一系列的数据操作都是好的。自信满满的把文件交付给了客户，可是在客户服务器上更新时，却报错了！</p>
<p><a href="/images/2015/04/cmd_update.jpg"><img src="/images/2015/04/cmd_update.jpg" alt="cmd_update"></a></p>
<p>请大家不要介意这蛋疼的win服务器，其实我也很蛋疼。。。</p>
<p>而我的dbschema里没定义什么东西啊，只是简单的加了个字段。</p>
<p><a href="/images/2015/04/dbschema.jpg"><img src="/images/2015/04/dbschema.jpg" alt="dbschema"></a></p>
<p>WARNING:512 @ ALTER IGNORE TABLE <code>sdb\_b2c\_members</code><br>ADD COLUMN <code>scu\_id</code> mediumint(8) unsigned default 0 comment ‘联盟商ID’ A<br>FTER crm_member_id;:You have an error in your SQL syntax; check the manual that<br>corresponds to your MySQL server version for the right syntax to use near ‘IGNOR<br>E TABLE <code>sdb\_b2c\_members</code><br>ADD COLUMN <code>scu\_id</code> mediumint(8) unsigned defau’ at line 1</p>
<p>查看了下服务器mysql版本，mysql 5.7！而我本地的好像是 5.0 还是几来着。难道是版本问题？但是如果版本有问题，APP安装时就应该报错啊。</p>
<p>在网上各种搜索，没有发现有遇到同样问题的人。而报错说得很明显了，应该是 IGNOR<br>E TABLE 有错，换了个关键词搜—— IGNOR<br>E TABLE mysql 5.7，终于搜索到了官方文档。</p>
<p><a href="/images/2015/04/mysql57_ignore.jpg"><img src="/images/2015/04/mysql57_ignore.jpg" alt="mysql57_ignore"></a></p>
<p>看文档中说的是，5.7以后移除了 IGNORE 这个扩展，以前用的最高版本的mysql是5.6，还真没注意过这个问题。</p>
<p>那现在的解决办法就有了，要么降级服务器mysql版本，要么就是更改ecstore中拼接sql语句的地方。</p>
<p>跟客户商量过后，显然是不同意降级版本，那就只能去改底层文件了。</p>
<p>打开 <strong>/app/base/lib/application/dbtable.php</strong> ， 搜索 <strong>ALTER IGNORE TABLE</strong> 替换成 <strong>ALTER TABLE</strong> 。再执行 <strong>cmd update</strong> 就OK了。</p>
<p>请注意，ecstore中，如果有数据表字段的修改等操作，需要通过 dbschema 进行操作，直接操作数据库是不起作用的。（这是常识-_-!）</p>
<p>其实后来想想，完全没必要二开这个文件的，可以在新app中加数据表做统计。但现在已经上线了，而且也解决了，就将错就错的走吧。</p>
<p>mysql官方文档：</p>
<p><a href="http://bugs.mysql.com/bug.php?id=40344" target="_blank" rel="noopener">http://bugs.mysql.com/bug.php?id=40344</a></p>
<p><a href="http://dev.mysql.com/worklog/task/?id=7395" target="_blank" rel="noopener">http://dev.mysql.com/worklog/task/?id=7395</a></p>

        </article>
    </div>
</section>

    </main>
    <footer class="footer"> Copyright 2013 - 2019 Ruesin. All Rights Reserved </footer>
  </body>
</html>