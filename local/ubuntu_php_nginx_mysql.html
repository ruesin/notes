<!DOCTYPE HTML>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>Ubuntu下php+nginx+mysql的安装与配置-信口开河</title>
    <meta name="keywords" content="Ruesin,信口开河">
    <meta name="description" content="至于你信不信，反正我是信了。">
    <link rel="stylesheet" href="/css/style.css">
</head>
  <body>
    
<header class="header">
    <nav class="navbar">
        <ul>
            
            <li><a class="header-nav-link" href="/">首页</a></li>
            
            <li><a class="header-nav-link" href="/categories">分类</a></li>
            
            <li><a class="header-nav-link" href="/archives">归档</a></li>
            
            <li><a class="header-nav-link" href="/tags">标签</a></li>
            
            <li><a class="header-nav-link" href="https://github.com/ruesin/notes">Github</a></li>
            
            <li><a class="header-nav-link" href="https://ruesin.github.io/php-tree">PHP技能树</a></li>
            
            <li><a class="header-nav-link" href="https://www.xinkoukaihe.com">老博客</a></li>
            
        </ul>
    </nav>
</header>
    <main class="main">
      <!-- 内容页 -->
<section class="section">
    <div class="post-container">
        <div class="post-header">
                <h1>Ubuntu下php+nginx+mysql的安装与配置</h1>
                <!-- <div class="post-meta">2015-06-10</div> -->
        </div>
        <article class="post-content">
            <p>之前有说用家里老电脑玩CentOs，但毕竟是主做服务器的，用来玩桌面确实有点不爽，遂又在另一台电脑上整上了Ubuntu玩。话说、几年前就已接触Ubuntu，而且也装过几次，但每次都是浅尝辄止，没有往更深的玩。</p>
<p>搭建这个环境实在不想使用Ubuntu自带的源，总感觉那么装下来的不是自己的东西，于是就自己大概散装了下。</p>
<p><a href="/images/2015/06/ubuntu.jpg"><img src="/images/2015/06/ubuntu.jpg" alt="ubuntu"></a></p>
<p><strong>一、Nginx</strong></p>
<p>安装必要的扩展包</p>
<pre><code>apt-get install libpcre3 libpcre3-dev
apt-get install libssl-dev openssl</code></pre><p>新建用户</p>
<pre><code>/usr/sbin/groupadd www
/usr/sbin/useradd -g www www</code></pre><p>编译安装</p>
<pre><code>wget http://nginx.org/download/nginx-1.5.1.tar.gz
tar zxvf nginx-1.5.1.tar.gz
cd nginx-1.5.1
./configure --user=www --group=www --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module  --with-http_realip_module
make &amp;&amp; make install</code></pre><pre><code>##启动
/usr/local/nginx/sbin/nginx
##创建软链接
ln -s /usr/local/nginx/sbin/nginx /etc/init.d/nginx
##开机启动
vi /etc/rc.local
##添加
service nginx</code></pre><p><strong>二、Mysql</strong></p>
<p>安装必要的扩展包</p>
<p><code>apt-get install libaio-dev</code>新建用户</p>
<pre><code>/usr/sbin/groupadd mysql
/usr/sbin/useradd -g mysql mysql</code></pre><p>编译安装</p>
<pre><code>wget http://cdn.mysql.com/archives/mysql-5.6/mysql-5.6.12-linux-glibc2.5-x86_64.tar.gz
tar zxvf mysql-5.6.12-linux-glibc2.5-x86_64.tar.gz -C /usr/local
mv /usr/local/mysql-5.6.12-linux-glibc2.5-x86_64/ /usr/local/mysql
cd /usr/local/mysql/
chown -R mysql .
chgrp -R mysql .
##生成mysql数据库运行的系统数据库，如果想把data单独拉出来的可以配置datadir
##sudo scripts/mysql_install_db --user=mysql --basedir=/usr/local/mysql --datadir=/data/mysql/data
scripts/mysql_install_db --user=mysql

##权限管理，保证安全
chown -R root .
chown -R mysql ./data

##启动
./support-files/mysql.server start

cp support-files/mysql.server /etc/init.d/mysql

##设置root密码
/usr/local/mysql/bin/mysql_secure_installation

##管理数据库测试下是否可用
./bin/mysql -uroot -p

##设置mysql服务开机启动
vi /etc/rc.local
##添加
service mysql start</code></pre><p><strong>三、PHP</strong></p>
<p>安装必要的扩展包<br>需要注意的是，我这里把扩展都装到自己指定的目录中了，这是强迫症患者的表现，希望能把整个环境独立出来单独管理。实际上，可以不写–prefix参数的，会默认安装到/usr/local中，如果选择使用默认的后面会少做很多处理。</p>
<pre><code>wget http://www.ijg.org/files/jpegsrc.v9.tar.gz
tar zxvf jpegsrc.v9.tar.gz
cd jpeg-9/
./configure --prefix=/usr/local/ruesinweb/libs --enable-shared --enable-static
make &amp;&amp; make install</code></pre><pre><code>wget http://prdownloads.sourceforge.net/libpng/libpng-1.6.2.tar.gz
tar zxvf libpng-1.6.2.tar.gz
cd libpng-1.6.2/
./configure --prefix=/usr/local/ruesinweb/libs
make &amp;&amp; make install</code></pre><pre><code>wget http://download.savannah.gnu.org/releases/freetype/freetype-2.4.12.tar.gz
tar zxvf freetype-2.4.12.tar.gz
cd freetype-2.4.12/
./configure --prefix=/usr/local/ruesinweb/libs
make &amp;&amp; make install</code></pre><p>`apt-get install libxml2-dev````<br>wget <a href="http://downloads.sourceforge.net/mhash/mhash-0.9.9.9.tar.gz" target="_blank" rel="noopener">http://downloads.sourceforge.net/mhash/mhash-0.9.9.9.tar.gz</a><br>wget <a href="http://downloads.sourceforge.net/mcrypt/libmcrypt-2.5.8.tar.gz" target="_blank" rel="noopener">http://downloads.sourceforge.net/mcrypt/libmcrypt-2.5.8.tar.gz</a><br>wget <a href="http://downloads.sourceforge.net/mcrypt/mcrypt-2.6.8.tar.gz" target="_blank" rel="noopener">http://downloads.sourceforge.net/mcrypt/mcrypt-2.6.8.tar.gz</a></p>
<p>tar zxvf libmcrypt-2.5.8.tar.gz<br>cd libmcrypt-2.5.8/<br>./configure –prefix=/usr/local/ruesinweb/libs<br>make &amp;&amp; make install<br>cd libltdl/<br>./configure –prefix=/usr/local/ruesinweb/libs –enable-ltdl-install<br>make &amp;&amp; make install</p>
<p>tar zxvf mhash-0.9.9.9.tar.gz<br>cd mhash-0.9.9.9/<br>./configure –prefix=/usr/local/ruesinweb/libs<br>make &amp;&amp; make install</p>
<p>##编辑 /etc/ld.so.conf 加入类库，加载动态装入器。<br>vi /etc/ld.so.conf<br>/usr/local/ruesinweb/libs/lib<br>ldconfig</p>
<p>tar zxvf mcrypt-2.6.8.tar.gz<br>cd mcrypt-2.6.8/</p>
<p>##编辑变量，引入指定的库位置，如果之前编译扩展都在默认目录中，就不用做这个操作了<br>export LDFLAGS=”-L/usr/local/ruesinweb/libs/lib -L/usr/lib”<br>export CFLAGS=”-I/usr/local/ruesinweb/libs/include -I/usr/include”<br>touch malloc.h<br>./configure –prefix=/usr/local/ruesinweb/libs –with-libmcrypt-prefix=/usr/local/ruesinweb/libs<br>make &amp;&amp; make install</p>
<pre><code>
编译安装php
</code></pre><p>tar zvxf php-5.4.41.tar.gz<br>cd php-5.4.41<br>./configure –prefix=/usr/local/php –enable-fpm –with-mysql=/usr/local/mysql <br>–with-mysqli=/usr/local/mysql/bin/mysql_config –with-config-file-path=/usr/local/php  <br>–with-openssl –enable-mbstring  –with-zlib –enable-xml <br>–with-png-dir=/usr/local/ruesinweb/libs –with-freetype-dir=/usr/local/ruesinweb/libs –with-gd –with-jpeg-dir=/usr/local/ruesinweb/libs   <br>–enable-bcmath –with-mcrypt=/usr/local/ruesinweb/libs –with-iconv –enable-pcntl –enable-shmop –enable-simplexml –enable-ftp \</p>
<p>##–with-curl</p>
<p>make &amp;&amp; make install</p>
<p>##复制配置文件<br>cp php.ini-development /usr/local/php/php.ini</p>
<p>cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf</p>
<p>##复制php-fpm启动脚本<br>cp sapi/fpm/php-fpm /etc/init.d/php-fpm</p>
<p>##赋予脚本执行权限<br>chmod +x /etc/init.d/php-fpm</p>
<p>##需要修改 php-fpm.conf，确保 php-fpm 模块使用 www 身份运行。<br>vi /usr/local/php/etc/php-fpm.conf</p>
<p>user = www<br>group = www</p>
<p>##启动 php-fpm 服务<br>/usr/local/bin/php-fpm</p>
<p>##设置 php-fpm 开机启动<br>vi /etc/rc.local<br>添加<br>service php-fpm</p>
<pre><code>
编辑 php.ini 文件中的配置项 cgi.fix\_pathinfo 设置为 0 ，如果文件不存在，则阻止 Nginx 将请求发送到后端的 PHP-FPM 模块， 以避免遭受恶意脚本注入的攻击。
</code></pre><p>vi /usr/local/php/php.ini<br>cgi.fix_pathinfo=0</p>
<pre><code>
配置 Nginx 使其支持 PHP 应用：

`vi /usr/local/nginx/conf/nginx.conf`修改默认的 location 块，使其支持 .php 文件：
</code></pre><p>location / {<br>    root   html;<br>    index  index.php index.html index.htm;<br>}</p>
<pre><code>
编辑默认的 PHP 配置块，保证 .php 文件的请求将被传送到后端的 PHP-FPM 模块，
</code></pre><p>location ~* .php$ {<br>    fastcgi_index   index.php;<br>    fastcgi_pass    127.0.0.1:9000;<br>    include         fastcgi_params;<br>    fastcgi_param   SCRIPT_FILENAME    $document_root$fastcgi_script_name;<br>    fastcgi_param   SCRIPT_NAME        $fastcgi_script_name;<br>}</p>
<pre><code>
重启 Nginx。
</code></pre><p>sudo /usr/local/nginx/sbin/nginx -s stop<br>sudo /usr/local/nginx/sbin/nginx</p>
<pre><code>
重启 php-fpm  
使用 ps aux | grep php-fpm ，查看进程号。

`kill -USR2 进程号`</code></pre>
        </article>
    </div>
</section>

    </main>
    <footer class="footer"> Copyright 2013 - 2019 Ruesin. All Rights Reserved </footer>
  </body>
</html>